import{S as A,i as F,s as R,n as N,d as I,b as M,D as w,e as D,P as O,j as E,Q as de,z as pe,o as P,p as V,a as we,x as $,v as x,U as ee,c as L,C as j,f as q,g as Ie,h as B,t as Le,k as U,l as _e,m as G,q as Q,r as J,u as W,O as De,F as te,V as le}from"../chunks/Dl-CPQHr.js";import"../chunks/IHki7fMi.js";import{e as Y}from"../chunks/r7f6XsU6.js";import{A as ne}from"../chunks/B8Bu-ZRe.js";import{g as re}from"../chunks/CySb9U9S.js";import{u as me}from"../chunks/XqiliRdc.js";import{s as Ee}from"../chunks/CPbIu-fp.js";function ye(r){let e,l='<div class="head svelte-1epg30x"><span>Chapters</span></div> <div class="hori-divider svelte-1epg30x"></div>';return{c(){e=E("div"),e.innerHTML=l,this.h()},l(t){e=D(t,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-72hea5"&&(e.innerHTML=l),this.h()},h(){w(e,"class","top-nav svelte-1epg30x")},m(t,n){M(t,e,n)},p:N,i:N,o:N,d(t){t&&I(e)}}}let Ve=class extends A{constructor(e){super(),F(this,e,null,ye,R,{})}};function Te(r,e,l){let{selectedChapter:t}=e,{goBack:n}=e;return r.$$set=i=>{"selectedChapter"in i&&l(0,t=i.selectedChapter),"goBack"in i&&l(1,n=i.goBack)},[t,n]}class Pe extends A{constructor(e){super(),F(this,e,Te,null,R,{selectedChapter:0,goBack:1})}}function ie(r,e,l){const t=r.slice();return t[8]=e[l],t}function se(r){let e,l='<i class="fa fa-link"></i>',t,n;return{c(){e=E("div"),e.innerHTML=l,this.h()},l(i){e=D(i,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-ecnmjt"&&(e.innerHTML=l),this.h()},h(){w(e,"class","btn btn-warning")},m(i,c){M(i,e,c),t||(n=j(e,"click",r[5]),t=!0)},p:N,d(i){i&&I(e),t=!1,n()}}}function ce(r){let e,l;return e=new ge({props:{selectedChapter:r[1],chapter:r[8],selectChapter:r[2],visitChapter:r[3]}}),{c(){W(e.$$.fragment)},l(t){J(e.$$.fragment,t)},m(t,n){Q(e,t,n),l=!0},p(t,n){const i={};n&2&&(i.selectedChapter=t[1]),n&1&&(i.chapter=t[8]),n&4&&(i.selectChapter=t[2]),n&8&&(i.visitChapter=t[3]),e.$set(i)},i(t){l||(V(e.$$.fragment,t),l=!0)},o(t){P(e.$$.fragment,t),l=!1},d(t){G(e,t)}}}function He(r){let e,l,t=r[0].title+"",n,i,c,s,f='<i class="fa fa-eye"></i>',d,b,v,k,z,m=r[4]&&r[4].admin&&se(r),T=Y(r[0].children||[]),p=[];for(let u=0;u<T.length;u+=1)p[u]=ce(ie(r,T,u));const y=u=>P(p[u],1,1,()=>{p[u]=null});return{c(){e=E("li"),l=E("div"),n=Le(t),i=U(),m&&m.c(),c=U(),s=E("div"),s.innerHTML=f,d=U(),b=E("div");for(let u=0;u<p.length;u+=1)p[u].c();this.h()},l(u){e=D(u,"LI",{class:!0});var h=q(e);l=D(h,"DIV",{class:!0});var a=q(l);n=Ie(a,t),i=B(a),m&&m.l(a),c=B(a),s=D(a,"DIV",{class:!0,"data-svelte-h":!0}),O(s)!=="svelte-18v9znn"&&(s.innerHTML=f),a.forEach(I),d=B(h),b=D(h,"DIV",{class:!0});var o=q(b);for(let _=0;_<p.length;_+=1)p[_].l(o);o.forEach(I),h.forEach(I),this.h()},h(){w(s,"class","btn btn-outline-primary"),w(l,"class","head svelte-1dlvoiu"),w(b,"class","children svelte-1dlvoiu"),w(e,"class","chapter svelte-1dlvoiu"),ee(e,"selected",r[1]?r[1].id===r[0].id:!1)},m(u,h){M(u,e,h),L(e,l),L(l,n),L(l,i),m&&m.m(l,null),L(l,c),L(l,s),L(e,d),L(e,b);for(let a=0;a<p.length;a+=1)p[a]&&p[a].m(b,null);v=!0,k||(z=[j(s,"click",r[6]),j(l,"click",r[7])],k=!0)},p(u,[h]){if((!v||h&1)&&t!==(t=u[0].title+"")&&we(n,t),u[4]&&u[4].admin?m?m.p(u,h):(m=se(u),m.c(),m.m(l,c)):m&&(m.d(1),m=null),h&15){T=Y(u[0].children||[]);let a;for(a=0;a<T.length;a+=1){const o=ie(u,T,a);p[a]?(p[a].p(o,h),V(p[a],1)):(p[a]=ce(o),p[a].c(),V(p[a],1),p[a].m(b,null))}for($(),a=T.length;a<p.length;a+=1)y(a);x()}(!v||h&3)&&ee(e,"selected",u[1]?u[1].id===u[0].id:!1)},i(u){if(!v){for(let h=0;h<T.length;h+=1)V(p[h]);v=!0}},o(u){p=p.filter(Boolean);for(let h=0;h<p.length;h+=1)P(p[h]);v=!1},d(u){u&&I(e),m&&m.d(),de(p,u),k=!1,pe(z)}}}function Me(r,e,l){let t;_e(r,me,v=>l(4,t=v));let{chapter:n}=e,{selectedChapter:i}=e,{selectChapter:c}=e,{visitChapter:s}=e;const f=()=>{re(`/chapters/${n.id}/edit`)},d=()=>{re(`/chapters/${n.id}`)},b=()=>c(n);return r.$$set=v=>{"chapter"in v&&l(0,n=v.chapter),"selectedChapter"in v&&l(1,i=v.selectedChapter),"selectChapter"in v&&l(2,c=v.selectChapter),"visitChapter"in v&&l(3,s=v.visitChapter)},[n,i,c,s,t,f,d,b]}class ge extends A{constructor(e){super(),F(this,e,Me,He,R,{chapter:0,selectedChapter:1,selectChapter:2,visitChapter:3})}}function ae(r,e,l){const t=r.slice();return t[18]=e[l],t}function oe(r){let e,l,t,n,i='<i class="fa fa-plus"></i>',c,s;return{c(){e=E("div"),l=E("input"),t=U(),n=E("div"),n.innerHTML=i,this.h()},l(f){e=D(f,"DIV",{class:!0});var d=q(e);l=D(d,"INPUT",{type:!0,class:!0,placeholder:!0}),t=B(d),n=D(d,"DIV",{class:!0,"data-svelte-h":!0}),O(n)!=="svelte-s2brqn"&&(n.innerHTML=i),d.forEach(I),this.h()},h(){w(l,"type","text"),w(l,"class","form-control"),w(l,"placeholder","Create Chapter"),w(n,"class","btn btn-info"),w(e,"class","createChapter inline-form")},m(f,d){M(f,e,d),L(e,l),le(l,r[5]),L(e,t),L(e,n),c||(s=[j(l,"input",r[11]),j(n,"click",r[10])],c=!0)},p(f,d){d&32&&l.value!==f[5]&&le(l,f[5])},d(f){f&&I(e),c=!1,pe(s)}}}function Be(r){let e,l;return e=new Pe({props:{selectedChapter:r[1],goBack:r[12]}}),{c(){W(e.$$.fragment)},l(t){J(e.$$.fragment,t)},m(t,n){Q(e,t,n),l=!0},p(t,n){const i={};n&2&&(i.selectedChapter=t[1]),n&2&&(i.goBack=t[12]),e.$set(i)},i(t){l||(V(e.$$.fragment,t),l=!0)},o(t){P(e.$$.fragment,t),l=!1},d(t){G(e,t)}}}function Ue(r){let e,l,t=Y(r[2]||[]),n=[];for(let c=0;c<t.length;c+=1)n[c]=fe(ae(r,t,c));const i=c=>P(n[c],1,1,()=>{n[c]=null});return{c(){e=E("ul");for(let c=0;c<n.length;c+=1)n[c].c();this.h()},l(c){e=D(c,"UL",{class:!0});var s=q(e);for(let f=0;f<n.length;f+=1)n[f].l(s);s.forEach(I),this.h()},h(){w(e,"class","clean-list chapters")},m(c,s){M(c,e,s);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);l=!0},p(c,s){if(s&773){t=Y(c[2]||[]);let f;for(f=0;f<t.length;f+=1){const d=ae(c,t,f);n[f]?(n[f].p(d,s),V(n[f],1)):(n[f]=fe(d),n[f].c(),V(n[f],1),n[f].m(e,null))}for($(),f=t.length;f<n.length;f+=1)i(f);x()}},i(c){if(!l){for(let s=0;s<t.length;s+=1)V(n[s]);l=!0}},o(c){n=n.filter(Boolean);for(let s=0;s<n.length;s+=1)P(n[s]);l=!1},d(c){c&&I(e),de(n,c)}}}function fe(r){let e,l;return e=new ge({props:{selectedChapter:r[0],chapter:r[18],selectChapter:r[8],visitChapter:r[9]}}),{c(){W(e.$$.fragment)},l(t){J(e.$$.fragment,t)},m(t,n){Q(e,t,n),l=!0},p(t,n){const i={};n&1&&(i.selectedChapter=t[0]),n&4&&(i.chapter=t[18]),e.$set(i)},i(t){l||(V(e.$$.fragment,t),l=!0)},o(t){P(e.$$.fragment,t),l=!1},d(t){G(e,t)}}}function qe(r){let e,l='<i class="fa fa-check"></i>';return{c(){e=E("div"),e.innerHTML=l,this.h()},l(t){e=D(t,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-1i6i9n1"&&(e.innerHTML=l),this.h()},h(){w(e,"class","btn btn-success")},m(t,n){M(t,e,n)},p:N,d(t){t&&I(e)}}}function ze(r){let e,l="Unsaved Progress",t,n;return{c(){e=E("div"),e.textContent=l,this.h()},l(i){e=D(i,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-llhlhm"&&(e.textContent=l),this.h()},h(){w(e,"class","btn btn-warning")},m(i,c){M(i,e,c),t||(n=j(e,"click",r[7]),t=!0)},p:N,d(i){i&&I(e),t=!1,n()}}}function ue(r){let e,l="Saving";return{c(){e=E("div"),e.textContent=l,this.h()},l(t){e=D(t,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-iwm6s2"&&(e.textContent=l),this.h()},h(){w(e,"class","btn btn-info")},m(t,n){M(t,e,n)},d(t){t&&I(e)}}}function Ke(r){let e,l,t,n,i,c,s,f,d,b,v;l=new Ve({});let k=r[6]&&r[6].admin&&oe(r);const z=[Ue,Be],m=[];function T(a,o){return a[1]?1:0}c=T(r),s=m[c]=z[c](r);function p(a,o){return a[3]&&!a[4]?ze:qe}let y=p(r),u=y(r),h=r[4]&&ue();return{c(){e=E("div"),W(l.$$.fragment),t=U(),k&&k.c(),n=U(),i=E("div"),s.c(),f=U(),d=E("div"),u.c(),b=U(),h&&h.c(),this.h()},l(a){e=D(a,"DIV",{class:!0});var o=q(e);J(l.$$.fragment,o),t=B(o),k&&k.l(o),n=B(o),i=D(o,"DIV",{class:!0});var _=q(i);s.l(_),_.forEach(I),f=B(o),d=D(o,"DIV",{class:!0});var C=q(d);u.l(C),b=B(C),h&&h.l(C),C.forEach(I),o.forEach(I),this.h()},h(){w(i,"class","wrapper svelte-nqxsi"),w(d,"class","saveProgress svelte-nqxsi"),w(e,"class","content")},m(a,o){M(a,e,o),Q(l,e,null),L(e,t),k&&k.m(e,null),L(e,n),L(e,i),m[c].m(i,null),L(e,f),L(e,d),u.m(d,null),L(d,b),h&&h.m(d,null),v=!0},p(a,[o]){a[6]&&a[6].admin?k?k.p(a,o):(k=oe(a),k.c(),k.m(e,n)):k&&(k.d(1),k=null);let _=c;c=T(a),c===_?m[c].p(a,o):($(),P(m[_],1,1,()=>{m[_]=null}),x(),s=m[c],s?s.p(a,o):(s=m[c]=z[c](a),s.c()),V(s,1),s.m(i,null)),y===(y=p(a))&&u?u.p(a,o):(u.d(1),u=y(a),u&&(u.c(),u.m(d,b))),a[4]?h||(h=ue(),h.c(),h.m(d,null)):h&&(h.d(1),h=null)},i(a){v||(V(l.$$.fragment,a),V(s),v=!0)},o(a){P(l.$$.fragment,a),P(s),v=!1},d(a){a&&I(e),G(l),k&&k.d(),m[c].d(),u.d(),h&&h.d()}}}function ve(r){if(r){for(let e=0;e<r.length;e++)r[e].position=e+1,r[e].children=ve(r[e].children);return r}}function he(r,e,l){const t=r[e];r[e]=r[l],r[l]=t}function Ce(r){return r.reduce((e,l)=>(e.push(l),l.children&&e.push(...Ce(l.children)),e),[])}function ke(r,e){for(let l of r){if(l.children&&l.children.some(t=>t.id===e))return l.id;if(l.children){const t=ke(l.children,e);if(t!==null)return t}}return null}function X(r,e){for(let l of r){if(l.id===e)return l;if(l.children){const t=X(l.children,e);if(t!==null)return t}}return null}function be(r,e){for(let l of r){if(l.children&&l.children.some(t=>t.id===e))return l.children;if(l.children){const t=be(l.children,e);if(t.length>0)return console.log("FOUND IN CHILDREN"),t}}return[]}function Z(r,e=null){return r.filter(t=>t.chapter_id===e).map(t=>{const n=Z(r,t.id);return{...t,children:n}}),r}function Ne(r,e,l){let t;_e(r,me,o=>l(6,t=o));let n=[],i=null,c=null,s=[],f=!1,d=!1;De(async()=>{n=await ne.get("/chapters.json"),console.log("first chapter fetch",n),l(2,s=Z(n)),console.log("organized chapters",s)}),te(()=>(window.addEventListener("keydown",b),()=>{window.removeEventListener("keydown",b)})),te(()=>(window.addEventListener("keydown",b),()=>{window.removeEventListener("keydown",b)}));function b(o){if(!i||!s)return;let _=-1,C=be(s,i.id);i.chapter_id?_=C.findIndex(g=>g.id===i.id):(C=s,_=s.findIndex(g=>g.id===i.id)),o.key==="s"||o.key==="w"?k(o,C,_):o.key==="d"?z(C):o.key==="a"&&m(C,_),l(2,s=s.map(g=>g.id===i.id&&i.chapter_id?{...g,children:[...C]}:g)),l(3,f=!0)}async function v(){l(4,d=!0);const o=ve(s);await Ee("/chapters/reorder",{list:Ce(o).map(_=>({id:_.id,chapter_id:_.chapter_id,position:_.position}))}),l(4,d=!1),l(3,f=!1)}function k(o,_,C){i&&(console.log(_?{container:_}:"no parent"),o.key==="s"&&C<_.length-1?he(_,C,C+1):o.key==="w"&&C>0&&he(_,C,C-1))}function z(o,_){const C=o.indexOf(i),g=C-1;if(console.log({futureParentIndex:g}),g>=0&&g<o.length-1){const H=o.splice(C,1)[0];l(0,i.chapter_id=o[g].id,i),o[g].children||(o[g].children=[]),o[g].children=[...o[g].children,H]}}function m(o,_){if(!(!i||!i.chapter_id)){const C=ke(s,i.chapter_id);let g,H,S;if(C!==null?(g=X(s,C),H=X(s,i.chapter_id),S=g.children.findIndex(K=>K.id===H.id),console.log({newParent:g}),console.log({currentParent:H}),console.log({currentParentIndex:S})):(g=s,H=X(s,i.chapter_id),S=g.findIndex(K=>K.id===H.id)),S>=0){const K=H.children.splice(_,1)[0];console.log(H.children),K.chapter_id=g.id,Array.isArray(g)?g.splice(S+1,0,K):g.children.splice(S+1,0,K);return}return}}function T(o){l(0,i=o),console.log({selectedChapter:i})}function p(o){l(1,c=o),console.log({visitingChapter:c})}let y;async function u(){if(y.length<2)return;const o=await ne.post("/chapters",{title:y,positon:s.length+1});console.log({res:o}),n=[...n,o],l(2,s=Z(n)),l(5,y="")}function h(){y=this.value,l(5,y)}return[i,c,s,f,d,y,t,v,T,p,u,h,()=>l(1,c=null)]}class Oe extends A{constructor(e){super(),F(this,e,Ne,Ke,R,{})}}function Se(r){let e,l;return e=new Oe({}),{c(){W(e.$$.fragment)},l(t){J(e.$$.fragment,t)},m(t,n){Q(e,t,n),l=!0},p:N,i(t){l||(V(e.$$.fragment,t),l=!0)},o(t){P(e.$$.fragment,t),l=!1},d(t){G(e,t)}}}class Xe extends A{constructor(e){super(),F(this,e,null,Se,R,{})}}export{Xe as component};
